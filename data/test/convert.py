import json

# Učitaj podatke iz JSON-a
with open("steam_country_stats.json", "r", encoding="utf-8") as f:
    data = json.load(f)

# Tvoja mapa država/valuta
countryToRegion = {
    "Afghanistan": "",
    "Albania": "Euro",
    "Algeria": "MENA - U.S. Dollar",
    "Angola": "South African Rand",
    "Antarctica": "",
    "Argentina": "LATAM - U.S. Dollar",
    "Armenia": "Russian Ruble",
    "Australia": "Australian Dollar",
    "Austria": "Euro",
    "Azerbaijan": "Russian Ruble",
    "Bangladesh": "Indian Rupee",
    "Belarus": "Russian Ruble",
    "Belgium": "Euro",
    "Belize": "U.S. Dollar",
    "Benin": "South African Rand",
    "Bermuda": "U.S. Dollar",
    "Bhutan": "Indian Rupee",
    "Bolivia": "LATAM - U.S. Dollar",
    "Bosnia and Herzegovina": "Euro",
    "Botswana": "South African Rand",
    "Brazil": "Brazilian Real",
    "Brunei": "Singapore Dollar",
    "Bulgaria": "Euro",
    "Burkina Faso": "South African Rand",
    "Burundi": "South African Rand",
    "Cambodia": "Vietnamese Dong",
    "Cameroon": "South African Rand",
    "Canada": "Canadian Dollar",
    "Central African Republic": "South African Rand",
    "Chad": "South African Rand",
    "Chile": "Chilean Peso",
    "China": "Chinese Yuan",
    "Colombia": "Colombian Peso",
    "Costa Rica": "Costa Rican Colon",
    "Croatia": "Euro",
    "Cuba": "",
    "Cyprus": "Euro",
    "Czech Republic": "Euro",
    "Democratic Republic of the Congo": "South African Rand",
    "Denmark": "Euro",
    "Djibouti": "South African Rand",
    "Dominican Republic": "U.S. Dollar",
    "East Timor": "U.S. Dollar",
    "Ecuador": "LATAM - U.S. Dollar",
    "Egypt": "MENA - U.S. Dollar",
    "El Salvador": "U.S. Dollar",
    "Equatorial Guinea": "South African Rand",
    "Eritrea": "South African Rand",
    "Estonia": "Euro",
    "Ethiopia": "South African Rand",
    "Falkland Islands": "U.S. Dollar",
    "Fiji": "Australian Dollar",
    "Finland": "Euro",
    "France": "Euro",
    "French Guiana": "Euro",
    "French Southern and Antarctic Lands": "Euro",
    "Gabon": "South African Rand",
    "Gambia": "South African Rand",
    "Georgia": "Russian Ruble",
    "Germany": "Euro",
    "Ghana": "South African Rand",
    "Greece": "Euro",
    "Greenland": "Euro",
    "Guatemala": "U.S. Dollar",
    "Guinea": "South African Rand",
    "Guinea Bissau": "South African Rand",
    "Guyana": "U.S. Dollar",
    "Haiti": "U.S. Dollar",
    "Honduras": "U.S. Dollar",
    "Hungary": "Euro",
    "Iceland": "Euro",
    "India": "Indian Rupee",
    "Indonesia": "Indonesian Rupiah",
    "Iran": "",
    "Iraq": "MENA - U.S. Dollar",
    "Ireland": "Euro",
    "Israel": "Israeli New Shekel",
    "Italy": "Euro",
    "Ivory Coast": "South African Rand",
    "Jamaica": "U.S. Dollar",
    "Japan": "Japanese Yen",
    "Jordan": "MENA - U.S. Dollar",
    "Kazakhstan": "Kazakhstani Tenge",
    "Kenya": "South African Rand",
    "Kosovo": "Euro",
    "Kuwait": "Kuwaiti Dinar",
    "Kyrgyzstan": "Russian Ruble",
    "Laos": "Vietnamese Dong",
    "Latvia": "Euro",
    "Lebanon": "MENA - U.S. Dollar",
    "Lesotho": "South African Rand",
    "Liberia": "South African Rand",
    "Libya": "MENA - U.S. Dollar",
    "Lithuania": "Euro",
    "Luxembourg": "Euro",
    "Macedonia": "Euro",
    "Madagascar": "South African Rand",
    "Malawi": "South African Rand",
    "Malaysia": "Malaysian Ringgit",
    "Mali": "South African Rand",
    "Malta": "Euro",
    "Mauritania": "South African Rand",
    "Mexico": "Mexican Peso",
    "Moldova": "Russian Ruble",
    "Mongolia": "Chinese Yuan",
    "Montenegro": "Euro",
    "Morocco": "MENA - U.S. Dollar",
    "Mozambique": "South African Rand",
    "Myanmar": "Vietnamese Dong",
    "Namibia": "South African Rand",
    "Nepal": "Indian Rupee",
    "Netherlands": "Euro",
    "New Caledonia": "Australian Dollar",
    "New Zealand": "New Zealand Dollar",
    "Nicaragua": "U.S. Dollar",
    "Niger": "South African Rand",
    "Nigeria": "South African Rand",
    "North Korea": "",
    "Northern Cyprus": "Euro",
    "Norway": "Norwegian Krone",
    "Oman": "MENA - U.S. Dollar",
    "Pakistan": "Indian Rupee",
    "Panama": "U.S. Dollar",
    "Papua New Guinea": "Australian Dollar",
    "Paraguay": "LATAM - U.S. Dollar",
    "Peru": "Peruvian Sol",
    "Philippines": "Philippine Peso",
    "Poland": "Polish Zloty",
    "Portugal": "Euro",
    "Puerto Rico": "U.S. Dollar",
    "Qatar": "Qatari Riyal",
    "Republic of Serbia": "Euro",
    "Republic of the Congo": "South African Rand",
    "Romania": "Euro",
    "Russia": "Russian Ruble",
    "Rwanda": "South African Rand",
    "Saudi Arabia": "Saudi Riyal",
    "Senegal": "South African Rand",
    "Sierra Leone": "South African Rand",
    "Slovakia": "Euro",
    "Slovenia": "Euro",
    "Solomon Islands": "Australian Dollar",
    "Somalia": "South African Rand",
    "Somaliland": "South African Rand",
    "South Africa": "South African Rand",
    "South Korea": "South Korean Won",
    "South Sudan": "South African Rand",
    "Spain": "Euro",
    "Sri Lanka": "Indian Rupee",
    "Sudan": "South African Rand",
    "Suriname": "U.S. Dollar",
    "Swaziland": "South African Rand",
    "Sweden": "Euro",
    "Switzerland": "Swiss Franc",
    "Syria": "MENA - U.S. Dollar",
    "Taiwan": "Taiwan Dollar",
    "Tajikistan": "Russian Ruble",
    "Thailand": "Thai Baht",
    "The Bahamas": "U.S. Dollar",
    "Togo": "South African Rand",
    "Trinidad and Tobago": "U.S. Dollar",
    "Tunisia": "MENA - U.S. Dollar",
    "Turkey": "MENA - U.S. Dollar",
    "Turkmenistan": "Russian Ruble",
    "Uganda": "South African Rand",
    "Ukraine": "Ukrainian Hryvnia",
    "United Arab Emirates": "U.A.E. Dirham",
    "United Kingdom": "British Pound",
    "United Republic of Tanzania": "South African Rand",
    "United States of America": "U.S. Dollar",
    "Uruguay": "Uruguayan Peso",
    "Uzbekistan": "Russian Ruble",
    "Vanuatu": "Australian Dollar",
    "Venezuela": "LATAM - U.S. Dollar",
    "Vietnam": "Vietnamese Dong",
    "West Bank": "MENA - U.S. Dollar",
    "Western Sahara": "MENA - U.S. Dollar",
    "Yemen": "MENA - U.S. Dollar",
    "Zambia": "South African Rand",
    "Zimbabwe": "South African Rand"
}

# Pripremi podatke za normalizaciju imena država i uklanjanje duplikata
unique = {}
for entry in data:
    country_raw = entry["country"].strip().title()  # Pretvori "AUSTRALIA" u "Australia"
    # Pronađi točno ime države iz countryToRegion (ako postoji)
    # Ovo radi "obrnuto" pretraživanje: traži ključ koji title-case-iran odgovara country_raw
    canonical_country = None
    for cname in countryToRegion:
        if cname.lower() == country_raw.lower():
            canonical_country = cname
            break
    # Ako nije pronađeno, koristi country_raw
    if canonical_country is None:
        canonical_country = country_raw
    if canonical_country not in unique:
        region_currency = countryToRegion.get(canonical_country, "")
        entry["country"] = canonical_country  # Postavi ime države iz mape!
        entry["regionCurrency"] = region_currency
        unique[canonical_country] = entry

# Pretvori u listu i spremi
result = list(unique.values())
with open("steam_country_stats_unified.json", "w", encoding="utf-8") as f:
    json.dump(result, f, ensure_ascii=False, indent=4)

print(f"Spremljeno {len(result)} država u steam_country_stats_unified.json")
