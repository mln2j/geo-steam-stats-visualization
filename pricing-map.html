<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Map - Steam Data Visualization</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"></script>
</head>
<body>
<div class="container">
    <header class="navbar">
        <div class="navbar-container">
            <h1 class="navbar-title">SteamGlobe</h1>
            <nav class="navbar-nav">
                <a href="pricing-map.html" class="navbar-link active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        <path d="M2 12h20"></path>
                    </svg>
                    Pricing Map
                </a>
                <a href="playtime-stats.html" class="navbar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    Playtime stats
                </a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="page-header">
            <h1 class="page-title">World Map Steam Pricing</h1>
            <p class="page-description">
                Click on countries to view detailed Steam prices of the top 100 titles for that country. Click on a second country to compare prices
                between them.
            </p>
        </div>

        <div class="visualization-grid">

            <div>
                <h2 class="card-title">World Map</h2>
                <div class="card map-card">
                    <div class="card-content">
                        <div id="world-map" class="world-map-container"></div>
                    </div>
                </div>
            </div>


            <div>
                <h2 class="card-title">Statistics</h2>
                <div class="card stats-card">
                    <div class="card-header">

                    </div>
                    <div class="card-content">
                        <div id="country-stats" class="country-stats-container">
                            <div id="no-selection-message" class="no-selection-message">
                                Click on a country to view statistics
                            </div>
                            <div id="stats-tabs" class="tabs" style="display: none;">
                                <div class="tabs-list">
                                    <button class="tab-button active" data-tab="players">Player Count</button>
                                    <button class="tab-button" data-tab="playtime">Avg. Play Time</button>
                                    <button class="tab-button" data-tab="inventory">Avg. Inventory Value</button>
                                </div>
                                <div class="tab-content active" id="players-tab">
                                    <div id="player-chart" class="chart-container"></div>
                                </div>
                                <div class="tab-content" id="playtime-tab">
                                    <div id="playtime-chart" class="chart-container"></div>
                                </div>
                                <div class="tab-content" id="inventory-tab">
                                    <div id="inventory-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <p class="footer-text">
                &copy; <span id="current-year"></span> Steam Data Visualization. All rights reserved.
            </p>
        </div>
    </footer>
</div>

<script>
    document.getElementById('current-year').textContent = new Date().getFullYear();


</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var width = 900, height = 500;

        var projection = d3.geo.mercator()
            .scale(140)
            .translate([width / 2, height / 1.5]);

        var path = d3.geo.path().projection(projection);

        var zoom = d3.behavior.zoom()
            .scaleExtent([1, 8])
            .on("zoom", zoomed);

        var svg = d3.select("#world-map").append("svg")
            .attr("width", width)
            .attr("height", height)
            .call(zoom)
            .append("g");

        function zoomed() {
            var t = d3.event.translate,
                s = d3.event.scale;
            zoom.translate(t);
            svg.attr("transform", "translate(" + t + ")scale(" + s + ")");
        }

        // 1. Mapiranje država na regije/valute
        // Ovo je primjer, proširi ga prema potrebama i podacima
        var countryToRegion = {
            "Afghanistan": "",
            "Albania": "Euro",
            "Algeria": "MENA - U.S. Dollar",
            "Angola": "South African Rand",
            "Antarctica": "",
            "Argentina": "LATAM - U.S. Dollar",
            "Armenia": "Russian Ruble",
            "Australia": "Australian Dollar",
            "Austria": "Euro",
            "Azerbaijan": "Russian Ruble",
            "Bangladesh": "Indian Rupee",
            "Belarus": "Russian Ruble",
            "Belgium": "Euro",
            "Belize": "U.S. Dollar",
            "Benin": "South African Rand",
            "Bermuda": "U.S. Dollar",
            "Bhutan": "Indian Rupee",
            "Bolivia": "LATAM - U.S. Dollar",
            "Bosnia and Herzegovina": "Euro",
            "Botswana": "South African Rand",
            "Brazil": "Brazilian Real",
            "Brunei": "Singapore Dollar",
            "Bulgaria": "Euro",
            "Burkina Faso": "South African Rand",
            "Burundi": "South African Rand",
            "Cambodia": "Vietnamese Dong",
            "Cameroon": "South African Rand",
            "Canada": "Canadian Dollar",
            "Central African Republic": "South African Rand",
            "Chad": "South African Rand",
            "Chile": "Chilean Peso",
            "China": "Chinese Yuan",
            "Colombia": "Colombian Peso",
            "Costa Rica": "Costa Rican Colon",
            "Croatia": "Euro",
            "Cuba": "",
            "Cyprus": "Euro",
            "Czech Republic": "Euro",
            "Democratic Republic of the Congo": "South African Rand",
            "Denmark": "Euro",
            "Djibouti": "South African Rand",
            "Dominican Republic": "U.S. Dollar",
            "East Timor": "U.S. Dollar",
            "Ecuador": "LATAM - U.S. Dollar",
            "Egypt": "MENA - U.S. Dollar",
            "El Salvador": "U.S. Dollar",
            "Equatorial Guinea": "South African Rand",
            "Eritrea": "South African Rand",
            "Estonia": "Euro",
            "Ethiopia": "South African Rand",
            "Falkland Islands": "U.S. Dollar",
            "Fiji": "Australian Dollar",
            "Finland": "Euro",
            "France": "Euro",
            "French Guiana": "Euro",
            "French Southern and Antarctic Lands": "Euro",
            "Gabon": "South African Rand",
            "Gambia": "South African Rand",
            "Georgia": "Russian Ruble",
            "Germany": "Euro",
            "Ghana": "South African Rand",
            "Greece": "Euro",
            "Greenland": "Euro",
            "Guatemala": "U.S. Dollar",
            "Guinea": "South African Rand",
            "Guinea Bissau": "South African Rand",
            "Guyana": "U.S. Dollar",
            "Haiti": "U.S. Dollar",
            "Honduras": "U.S. Dollar",
            "Hungary": "Euro",
            "Iceland": "Euro",
            "India": "Indian Rupee",
            "Indonesia": "Indonesian Rupiah",
            "Iran": "",
            "Iraq": "MENA - U.S. Dollar",
            "Ireland": "Euro",
            "Israel": "Israeli New Shekel",
            "Italy": "Euro",
            "Ivory Coast": "South African Rand",
            "Jamaica": "U.S. Dollar",
            "Japan": "Japanese Yen",
            "Jordan": "MENA - U.S. Dollar",
            "Kazakhstan": "Kazakhstani Tenge",
            "Kenya": "South African Rand",
            "Kosovo": "Euro",
            "Kuwait": "Kuwaiti Dinar",
            "Kyrgyzstan": "Russian Ruble",
            "Laos": "Vietnamese Dong",
            "Latvia": "Euro",
            "Lebanon": "MENA - U.S. Dollar",
            "Lesotho": "South African Rand",
            "Liberia": "South African Rand",
            "Libya": "MENA - U.S. Dollar",
            "Lithuania": "Euro",
            "Luxembourg": "Euro",
            "Macedonia": "Euro",
            "Madagascar": "South African Rand",
            "Malawi": "South African Rand",
            "Malaysia": "Malaysian Ringgit",
            "Mali": "South African Rand",
            "Malta": "Euro",
            "Mauritania": "South African Rand",
            "Mexico": "Mexican Peso",
            "Moldova": "Russian Ruble",
            "Mongolia": "Chinese Yuan",
            "Montenegro": "Euro",
            "Morocco": "MENA - U.S. Dollar",
            "Mozambique": "South African Rand",
            "Myanmar": "Vietnamese Dong",
            "Namibia": "South African Rand",
            "Nepal": "Indian Rupee",
            "Netherlands": "Euro",
            "New Caledonia": "Australian Dollar",
            "New Zealand": "New Zealand Dollar",
            "Nicaragua": "U.S. Dollar",
            "Niger": "South African Rand",
            "Nigeria": "South African Rand",
            "North Korea": "",
            "Northern Cyprus": "Euro",
            "Norway": "Norwegian Krone",
            "Oman": "MENA - U.S. Dollar",
            "Pakistan": "Indian Rupee",
            "Panama": "U.S. Dollar",
            "Papua New Guinea": "Australian Dollar",
            "Paraguay": "LATAM - U.S. Dollar",
            "Peru": "Peruvian Sol",
            "Philippines": "Philippine Peso",
            "Poland": "Polish Zloty",
            "Portugal": "Euro",
            "Puerto Rico": "U.S. Dollar",
            "Qatar": "Qatari Riyal",
            "Republic of Serbia": "Euro",
            "Republic of the Congo": "South African Rand",
            "Romania": "Euro",
            "Russia": "Russian Ruble",
            "Rwanda": "South African Rand",
            "Saudi Arabia": "Saudi Riyal",
            "Senegal": "South African Rand",
            "Sierra Leone": "South African Rand",
            "Slovakia": "Euro",
            "Slovenia": "Euro",
            "Solomon Islands": "Australian Dollar",
            "Somalia": "South African Rand",
            "Somaliland": "South African Rand",
            "South Africa": "South African Rand",
            "South Korea": "South Korean Won",
            "South Sudan": "South African Rand",
            "Spain": "Euro",
            "Sri Lanka": "Indian Rupee",
            "Sudan": "South African Rand",
            "Suriname": "U.S. Dollar",
            "Swaziland": "South African Rand",
            "Sweden": "Euro",
            "Switzerland": "Swiss Franc",
            "Syria": "MENA - U.S. Dollar",
            "Taiwan": "Taiwan Dollar",
            "Tajikistan": "Russian Ruble",
            "Thailand": "Thai Baht",
            "The Bahamas": "U.S. Dollar",
            "Togo": "South African Rand",
            "Trinidad and Tobago": "U.S. Dollar",
            "Tunisia": "MENA - U.S. Dollar",
            "Turkey": "MENA - U.S. Dollar",
            "Turkmenistan": "Russian Ruble",
            "Uganda": "South African Rand",
            "Ukraine": "Ukrainian Hryvnia",
            "United Arab Emirates": "U.A.E. Dirham",
            "United Kingdom": "British Pound",
            "United Republic of Tanzania": "South African Rand",
            "United States of America": "U.S. Dollar",
            "Uruguay": "Uruguayan Peso",
            "Uzbekistan": "Russian Ruble",
            "Vanuatu": "Australian Dollar",
            "Venezuela": "LATAM - U.S. Dollar",
            "Vietnam": "Vietnamese Dong",
            "West Bank": "MENA - U.S. Dollar",
            "Western Sahara": "MENA - U.S. Dollar",
            "Yemen": "MENA - U.S. Dollar",
            "Zambia": "South African Rand",
            "Zimbabwe": "South African Rand"
        };





        // 2. Tooltip helper
        var tooltip = d3.select("body").append("div")
            .attr("class", "d3-tooltip")
            .style("opacity", 0);

        // 3. Učitaj podatke o igrama i karti
        d3.json("data/data.json", function(error, gameData) {
            if (error) throw error;

            // Učitaj ispravan TopoJSON s imenima država
            d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json", function(error, world) {
                if (error) throw error;
                var countries = topojson.feature(world, world.objects.countries).features;

                // 4. Izračunaj prosječnu cijenu po regiji
                var avgPriceByRegion = {};
                Object.keys(countryToRegion).forEach(function(country) {
                    var region = countryToRegion[country];
                    var prices = gameData.map(function(game) {
                        var priceStr = game.regionalPrices[region];
                        if (!priceStr) return null;
                        var num = parseFloat(priceStr.replace(/[^\d,\.]/g, '').replace(',', '.'));
                        return isNaN(num) ? null : num;
                    }).filter(p => p !== null);
                    if (prices.length > 0) {
                        avgPriceByRegion[region] = d3.mean(prices);
                    }
                });

                // 5. Skala boja
                var color = d3.scale.linear()
                    .domain(d3.extent(Object.values(avgPriceByRegion)))
                    .range(["#cce5ff", "#003366"]);

                // 6. Iscrtaj države
                svg.selectAll("path")
                    .data(countries)
                    .enter().append("path")
                    .attr("d", path)
                    .attr("fill", d => {
                        const region = countryToRegion[d.properties.name];
                        return region ? color(avgPriceByRegion[region] || 0) : "#eee";
                    })
                    .attr("stroke", "#333")
                    .attr("stroke-width", 0.5)
                    .on("mouseover", function(d) {
                        const region = countryToRegion[d.properties.name];
                        d3.select(this).attr("fill", "#3399ff");
                        tooltip.transition().duration(100).style("opacity", 0.95);
                        tooltip.html(`
                        <strong>${d.properties.name}</strong><br>
                        ${region ? `Avg. price: ${avgPriceByRegion[region]?.toFixed(2) || 'N/A'}` : 'No data'}
                    `);
                    })
                    .on("mousemove", () => {
                        tooltip.style("left", (d3.event.pageX + 15) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        const region = countryToRegion[d.properties.name];
                        d3.select(this).attr("fill", region ? color(avgPriceByRegion[region] || 0) : "#eee");
                        tooltip.transition().duration(200).style("opacity", 0);
                    });
            });
        });
    });
</script>



</body>
</html>
